<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    article{
        width:60%;
        margin: 0 auto;
        height: 45vh;
        overflow-y: scroll;
        padding: 20px;
        box-sizing: border-box;
        border: 1px solid lightgrey;
    }
    #input{
        margin-bottom: 5vh;
    }
    h1{
        text-align: center;
    }
</style>
<body>
    <article id="input">
        <h1>Input:</h1>
    </article>
    <article id="output">
        <h1>Output:</h1>
    </article>
    <script>
        let roles={};
        const characters =['Почтмейстер','Городничий','Аммос Федорович'];
        let input="Почтмейстер: Объясните, господа, что, какой чиновник едет?\
Городничий: А вы разве не слышали?\
Почтмейстер: Слышал от Петра Ивановича Бобчинского. Он только что был у меня в почтовой конторе.\
Городничий: Ну, что? Как вы думаете об этом?\
Почтмейстер: А что думаю? война с турками будет.\
Аммос Федорович: В одно слово! я сам то же думал.\
Городничий: Да, оба пальцем в небо попали!\
Почтмейстер: Право, война с турками. Это все француз гадит.\
Городничий: Какая война с турками! Просто нам плохо будет, а не туркам. Это уже известно: у меня письмо.\
Почтмейстер: А если так, то не будет войны с турками.\
Городничий: Ну что же, как вы, Иван Кузьмич?\
Почтмейстер: Да что я? Как вы, Антон Антонович?\
Городничий: Да что я? Страху-то нет, а так, немножко... Купечество да гражданство меня смущает. Говорят, что я им солоно пришелся, а я, вот ей-Богу, если и взял с иного, то, право, без всякой ненависти. Я даже думаю (берет его под руку и отводит в сторону), я даже думаю, не было ли на меня какого-нибудь доноса. Зачем же в самом деле к нам ревизор? Послушайте, Иван Кузьмич, нельзя ли вам, для общей нашей пользы, всякое письмо, которое прибывает к вам в почтовую контору, входящее и исходящее, знаете, этак немножко распечатать и прочитать: не содержится ли в нем какого-нибудь донесения или просто переписки. Если же нет, то можно опять запечатать; впрочем, можно даже и так отдать письмо, распечатанное.\
Почтмейстер: Знаю, знаю... Этому не учите, это я делаю не то чтоб из предосторожности, а больше из любопытства: смерть люблю узнать, что есть нового на свете. Я вам скажу, что это преинтересное чтение. Иное письмо с наслажденьем прочтешь — так описываются разные пассажи... а назидательность какая... лучше, чем в «Московских ведомостях»!\
Городничий: Ну что ж, скажите, ничего не начитывали о каком-нибудь чиновнике из Петербурга?\
Почтмейстер: Нет, о петербургском ничего нет, а о костромских и саратовских много говорится. Жаль, однако ж, что вы не читаете писем: есть прекрасные места. Вот недавно один поручик пишет к приятелю и описал бал в самом игривом... очень, очень хорошо: «Жизнь моя, милый друг, течет, говорит, в эмпиреях: барышень много, музыка играет, штандарт скачет...» — с большим, с большим чувством описал. Я нарочно оставил его у себя. Хотите, прочту?\
Городничий: Ну, теперь не до того. Так сделайте милость, Иван Кузьмич: если на случай попадется жалоба или донесение, то без всяких рассуждений задерживайте.\
Почтмейстер: С большим удовольствием.\
Аммос Федорович: Смотрите, достанется вам когда-нибудь за это.\
Почтмейстер: Ах, батюшки!\
Городничий: Ничего, ничего. Другое дело, если бы вы из этого публичное что-нибудь сделали, но ведь это дело семейственное.\
Аммос Федорович: Да, нехорошее дело заварилось! А я, признаюсь, шел было к вам, Антон Антонович, с тем чтобы попотчевать вас собачонкою. Родная сестра тому кобелю, которого вы знаете. Ведь вы слышали, что Чептович с Варховинским затеяли тяжбу, и теперь мне роскошь: травлю зайцев на землях и у того и у другого.\
Городничий: Батюшки, не милы мне теперь ваши зайцы: у меня инкогнито проклятое сидит в голове. Так и ждешь, что вот отворится дверь и — шасть...";
        const regex1=new RegExp("([^,]\\s)*("+characters.join("|")+")(\\s\\(([а-я]+,?\\s?)+\\))?.\\s","g");
        const regex2=new RegExp("("+characters.join("|")+")(\\s\\(([а-я]+,?\\s?)+\\))?:\\s(\\(?[^\\r\\n][А-Яа-я]*[\\.;:,!?\\-]*\\)?(\\.{0,3})\\s?)+$","gm");
        input=input.replace('\n',"").replace(regex1,(x)=>" \n"+x);
        let play=input.match(regex2);
        play.forEach(string=>{
            let p=document.createElement("p");
            p.innerHTML=string;
            document.getElementById("input").appendChild(p);
        });
        play=play.map((element,index) => element=(index+1)+")"+element);
        for(let i=0;i<characters.length;i++){
            roles[characters[i]]=play.filter(string=>string.match(new RegExp(characters[i]+"(\\s\\(([а-я]+,?\\s?)+\\))?:\\s(\\(?[^\\r\\n][А-Яа-я]*[\\.;:,!?\\-]*\\)?(\\.{0,3})\\s?)+$","gm")));
        }
        for(let key in roles){
            let h=document.createElement("h2");
            h.innerHTML=key;
            document.getElementById("output").appendChild(h);
            roles[key].forEach(string=>{
                let p=document.createElement("p");
                p.innerHTML=string;
                document.getElementById("output").appendChild(p);
        });
        }
    </script>
</body>
</html>