<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    article{
        width:60%;
        margin: 0 auto;
        height: 45vh;
        overflow-y: scroll;
        padding: 20px;
        box-sizing: border-box;
        border: 1px solid lightgrey;
    }
    #input{
        margin-bottom: 5vh;
    }
    h1{
        text-align: center;
    }
</style>
<body>
    <article id="input">
        <h1>Input:</h1>
    </article>
    <article id="output">
        <h1>Output:</h1>
    </article>
    <script>
        let roles={};
        const characters =['Городничий','Аммос Федорович','Лука Лукич'];
        let input="Аммос Федорович: Нет, этого уже невозможно выгнать: он говорит, что в детстве мамка его ушибла, и с тех пор от него отдает немного водкою.\
Городничий: Да я так только заметил вам. Насчет же внутреннего распоряжения и того, что называет в письме Андрей Иванович грешками, я ничего не могу сказать. Да и странно говорить: нет человека, который бы за собою не имел каких-нибудь грехов. Это уже так Самим Богом устроено, и волтерианцы напрасно против этого говорят.\
Аммос Федорович: Что ж вы полагаете, Антон Антонович, грешками? Грешки грешкам — рознь. Я говорю всем открыто, что беру взятки, но чем взятки? Борзыми щенками. Это совсем иное дело.\
Городничий: Ну, щенками или чем другим — всё взятки.\
Аммос Федорович: Ну нет, Антон Антонович. А вот, например, если у кого-нибудь шуба стоит пятьсот рублей, да супруге шаль...\
Городничий: Ну, а что из того, что вы берете взятки борзыми щенками? Зато вы в Бога не веруете; вы в церковь никогда не ходите; а я по крайней мере в вере тверд и каждое воскресенье бываю в церкви. А вы... О, я знаю вас: вы если начнете говорить о сотворении мира, просто волосы дыбом поднимаются.\
Аммос Федорович: Да ведь сам собою дошел, собственным умом.\
Городничий: Ну, в ином случае много ума хуже, чем бы его совсем не было. Впрочем, я так только упомянул об уездном суде; а по правде сказать, вряд ли кто когда-нибудь заглянет туда: это уж такое завидное место, сам Бог ему покровительствует. А вот вам, Лука Лукич, так, как смотрителю учебных заведений, нужно позаботиться особенно насчет учителей. Они люди, конечно, ученые и воспитывались в разных коллегиях, но имеют очень странные поступки, натурально неразлучные с ученым званием. Один из них, например, вот этот, что имеет толстое лицо... не вспомню его фамилии, никак не может обойтись без того, чтобы, взошедши на кафедру, не сделать гримасу, вот этак (делает гримасу), и потом начнет рукою из-под галстука утюжить свою бороду. Конечно, если он ученику сделает такую рожу, то оно еще ничего: может быть, оно там и нужно так, об этом я не могу судить; но вы посудите сами, если он сделает это посетителю, — это может быть очень худо: господин ревизор или другой кто может принять это на свой счет. Из этого черт знает\ что может произойти.\
Лука Лукич: Что ж мне, право, с ним делать? Я уж несколько раз ему говорил. Вот еще на днях, когда зашел было в класс наш предводитель, он скроил такую рожу, какой я никогда еще не видывал. Он-то ее сделал от доброго сердца, а мне выговор: зачем вольнодумные мысли внушаются юношеству.\
Городничий: То же я должен вам заметить и об учителе по исторической части. Он ученая голова — это видно, и сведений нахватал тьму, но только объясняет с таким жаром, что не помнит себя. Я раз слушал его: ну, покамест говорил об ассириянах и вавилонянах — еще ничего, а как добрался до Александра Македонского, то я не могу вам сказать, что с ним сделалось. Я думал, что пожар, ей-Богу! Сбежал с кафедры и что силы есть хвать стулом об пол. Оно, конечно, Александр Македонский герой, но зачем же стулья ломать? от этого убыток казне.\
Лука Лукич: Да, он горяч! Я ему это несколько раз уже замечал... Говорит: «Как хотите, для науки я жизни не пощажу».\
Городничий: Да, таков уже неизъяснимый закон судеб: умный человек — или пьяница, или рожу такую состроит, что хоть святых выноси.\
Лука Лукич: Не приведи Бог служить по ученой части! Всего боишься: всякий мешается, всякому хочется показать, что он тоже умный человек.\
Городничий: Это бы еще ничего, — инкогнито проклятое! Вдруг заглянет: «А, вы здесь, голубчики! А кто, скажет, здесь судья?» — «Ляпкин-Тяпкин». — «А подать сюда Ляпкина-Тяпкина! А кто попечитель богоугодных заведений?» — «Земляника». — «А подать сюда Землянику!» Вот что худо!";
        const regex1=new RegExp("([^,]\\s)*("+characters.join("|")+")(\\s\\(([а-я]+,?\\s?)+\\))?.\\s","g");
        const regex2=new RegExp("("+characters.join("|")+")(\\s\\(([а-я]+,?\\s?)+\\))?:\\s(\\(?[^\\r\\n][А-Яа-я]*[\\.;:,!?\\-]*\\)?(\\.{0,3})\\s?)+$","gm");
        input=input.replace('\n',"").replace(regex1,(x)=>" \n"+x);
        let play=input.match(regex2);
        play.forEach(string=>{
            let p=document.createElement("p");
            p.innerHTML=string;
            document.getElementById("input").appendChild(p);
        });
        play=play.map((element,index) => element=(index+1)+")"+element);
        for(let i=0;i<characters.length;i++){
            roles[characters[i]]=play.filter(string=>string.match(new RegExp(characters[i]+"(\\s\\(([а-я]+,?\\s?)+\\))?:\\s(\\(?[^\\r\\n][А-Яа-я]*[\\.;:,!?\\-]*\\)?(\\.{0,3})\\s?)+$","gm")));
        }
        for(let key in roles){
            let h=document.createElement("h2");
            h.innerHTML=key;
            document.getElementById("output").appendChild(h);
            roles[key].forEach(string=>{
                let p=document.createElement("p");
                p.innerHTML=string;
                document.getElementById("output").appendChild(p);
        });
        }
    </script>
</body>
</html>