<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    article{
        width:60%;
        margin: 0 auto;
        height: 45vh;
        overflow-y: scroll;
        padding: 20px;
        box-sizing: border-box;
        border: 1px solid lightgrey;
    }
    #input{
        margin-bottom: 5vh;
    }
    h1{
        text-align: center;
    }
</style>
<body>
    <article id="input">
        <h1>Input:</h1>
    </article>
    <article id="output">
        <h1>Output:</h1>
    </article>
    <script>
        let roles={};
        const characters =['Городничий','Аммос Федорович','Артемий Филиппович','Лука Лукич'];
        let input="Городничий: Я пригласил вас, господа, с тем чтобы сообщить вам пренеприятное известие: к нам едет ревизор.\
Аммос Федорович: Как ревизор?\
Артемий Филиппович: Как ревизор?\
Городничий: Ревизор из Петербурга, инкогнито. И еще с секретным предписаньем.\
Аммос Федорович: Вот те на!\
Артемий Филиппович: Вот не было заботы, так подай!\
Лука Лукич: Господи Боже! еще и с секретным предписаньем!\
Городничий: Я как будто предчувствовал: сегодня мне всю ночь снились какие-то две необыкновенные крысы. Право, этаких я никогда не видывал: \
черные, неестественной величины! пришли, понюхали — и пошли прочь. Вот я вам прочту письмо, которое получил я от Андрея Ивановича Чмыхова, которого \
вы, Артемий Филиппович, знаете. Вот что он пишет: «Любезный друг, кум и благодетель (бормочет вполголоса, пробегая скоро глазами)... и уведомить тебя». \
А! вот: «Спешу, между прочим, уведомить тебя, что приехал чиновник с предписанием осмотреть всю губернию и особенно наш уезд (значительно поднимает палец вверх). \
Я узнал это от самых достоверных людей, хотя он представляет себя частным лицом. Так как я знаю, что за тобою, как за всяким, водятся грешки, потому \
что ты человек умный и не любишь пропускать того, что плывет в руки...» (остановясь), ну, здесь свои... «то советую тебе взять предосторожность, ибо он может \
приехать во всякий час, если только уже не приехал и не живет где-нибудь инкогнито... Вчерашнего дни я...» Ну, тут уж пошли дела \
семейные: «...сестра Анна Кириловна приехала к нам с своим мужем; Иван Кирилович очень потолстел и все играет на скрыпке...» — и прочее, и прочее. Так вот какое обстоятельство!\
Аммос Федорович: Да, обстоятельство такое... необыкновенно, просто необыкновенно. Что-нибудь недаром.\
Лука Лукич: Зачем же, Антон Антонович, отчего это? Зачем к нам ревизор?\
Городничий: Зачем! Так уж, видно, судьба! (Вздохнув.) До сих пор, благодарение Богу, подбирались к другим городам; теперь пришла очередь к нашему.\
Аммос Федорович: Я думаю, Антон Антонович, что здесь тонкая и больше политическая причина. Это значит вот что: Россия... да... хочет вести войну, и министерия-то, вот видите, \
и подослала чиновника, чтобы узнать, нет ли где измены.\
Городничий: Эк куда хватили! Еще умный человек! В уездном городе измена! Что он, пограничный, что ли? Да отсюда, хоть три года скачи, ни до какого государства не доедешь.\
Аммос Федорович: Нет, я вам скажу, вы не того... вы не... Начальство имеет тонкие виды: даром что далеко, а оно себе мотает на ус.\
Городничий: Мотает или не мотает, а я вас, господа, предуведомил. Смотрите, по своей части я кое-какие распоряженья сделал, советую и вам. Особенно \
вам, Артемий Филиппович! Без сомнения, проезжающий чиновник захочет прежде всего осмотреть подведомственные вам богоугодные заведения — и потому вы сделайте \
так, чтобы все было прилично: колпаки были бы чистые, и больные не походили бы на кузнецов, как обыкновенно они ходят по-домашнему.\
Артемий Филиппович: Ну, это еще ничего. Колпаки, пожалуй, можно надеть и чистые.\
Городничий: Да, и тоже над каждой кроватью надписать по-латыни или на другом каком языке... это уж по вашей части, Христиан Иванович, — всякую болезнь: когда кто заболел, которого дня и числа... \
Нехорошо, что у вас больные такой крепкий табак курят, что всегда расчихаешься, когда войдешь. Да и лучше, если б их было меньше: тотчас отнесут к дурному смотрению или к неискусству врача.\
Артемий Филиппович: О! насчет врачеванья мы с Христианом Ивановичем взяли свои меры: чем ближе к натуре, тем лучше, — лекарств дорогих мы не употребляем. Человек простой: если умрет, то и так умрет; \
если выздоровеет, то и так выздоровеет. Да и Христиану Ивановичу затруднительно было б с ними изъясняться: он по-русски ни слова не знает.";
        const regex1=new RegExp("([^,]\\s)*("+characters.join("|")+")(\\s\\(([а-я]+,?\\s?)+\\))?.\\s","g");
        const regex2=new RegExp("("+characters.join("|")+")(\\s\\(([а-я]+,?\\s?)+\\))?:\\s(\\(?[^\\r\\n][А-Яа-я]*[\\.;:,!?\\-]*\\)?(\\.{0,3})\\s?)+$","gm");
        input=input.replace('\n',"").replace(regex1,(x)=>" \n"+x);
        let play=input.match(regex2);
        play.forEach(string=>{
            let p=document.createElement("p");
            p.innerHTML=string;
            document.getElementById("input").appendChild(p);
        });
        play=play.map((element,index) => element=(index+1)+")"+element);
        for(let i=0;i<characters.length;i++){
            roles[characters[i]]=play.filter(string=>string.match(new RegExp(characters[i]+"(\\s\\(([а-я]+,?\\s?)+\\))?:\\s(\\(?[^\\r\\n][А-Яа-я]*[\\.;:,!?\\-]*\\)?(\\.{0,3})\\s?)+$","gm")));
        }
        for(let key in roles){
            let h=document.createElement("h2");
            h.innerHTML=key;
            document.getElementById("output").appendChild(h);
            roles[key].forEach(string=>{
                let p=document.createElement("p");
                p.innerHTML=string;
                document.getElementById("output").appendChild(p);
        });
        }
    </script>
</body>
</html>